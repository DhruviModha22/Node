<div class="card">
    <div style="margin-bottom: 30px;">
        <h1 class="article-title" style="font-size: 2.5rem; margin-bottom: 15px;">
            <%= article.title %>
        </h1>
        
        <div class="article-meta" style="margin-bottom: 20px;">
            By <strong><%= article.author.username %></strong> • 
            Published on <%= new Date(article.createdAt).toLocaleDateString() %>
            <% if (article.updatedAt > article.createdAt) { %>
                • Updated on <%= new Date(article.updatedAt).toLocaleDateString() %>
            <% } %>
        </div>
        
        <% if (article.tags && article.tags.length > 0) { %>
            <div class="article-tags" style="margin-bottom: 20px;">
                <% article.tags.forEach(tag => { %>
                    <span class="tag"><%= tag %></span>
                <% }) %>
            </div>
        <% } %>
        
        <div class="article-content" style="font-size: 1.1rem; line-height: 1.8;">
            <%= article.content %>
        </div>
        
        <% if (user && (user._id.toString() === article.author._id.toString() || user.role === 'admin')) { %>
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e1e5e9;">
                <a href="/articles/<%= article._id %>/edit" class="btn btn-secondary">Edit Article</a>
                <form method="POST" action="/articles/<%= article._id %>/delete" style="display: inline; margin-left: 10px;" 
                      onsubmit="return confirm('Are you sure you want to delete this article?')">
                    <button type="submit" class="btn btn-danger">Delete Article</button>
                </form>
            </div>
        <% } %>
    </div>
    
    <!-- Comments Section -->
    <div style="margin-top: 40px; padding-top: 30px; border-top: 2px solid #e1e5e9;">
        <h2 style="margin-bottom: 20px; color: #333;">Comments (<%= comments ? comments.length : 0 %>)</h2>
        
        <% if (user) { %>
            <div style="margin-bottom: 30px;">
                <form method="POST" action="/comments/<%= article._id %>">
                    <div class="form-group">
                        <label for="commentContent" class="form-label">Add a comment</label>
                        <textarea id="commentContent" name="content" class="form-input form-textarea" 
                                  placeholder="Share your thoughts..." required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Post Comment</button>
                </form>
            </div>
        <% } else { %>
            <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px; margin-bottom: 30px;">
                <p style="margin-bottom: 15px;">Please <a href="/auth/login" style="color: #667eea;">login</a> to leave a comment.</p>
            </div>
        <% } %>
        
        <% if (comments && comments.length > 0) { %>
            <div>
                <% comments.forEach(comment => { %>
                    <div class="comment">
                        <div class="comment-header">
                            <span class="comment-author"><%= comment.author.username %></span>
                            <span class="comment-date"><%= new Date(comment.createdAt).toLocaleDateString() %></span>
                        </div>
                        <div style="color: #555; line-height: 1.6;">
                            <%= comment.content %>
                        </div>
                        <% if (user && (user._id.toString() === comment.author._id.toString() || user.role === 'admin')) { %>
                            <div style="margin-top: 10px;">
                                <form method="POST" action="/comments/<%= comment._id %>/delete" style="display: inline;" 
                                      onsubmit="return confirm('Are you sure you want to delete this comment?')">
                                    <button type="submit" class="btn btn-danger" style="padding: 4px 12px; font-size: 12px;">
                                        Delete
                                    </button>
                                </form>
                            </div>
                        <% } %>
                    </div>
                <% }) %>
            </div>
        <% } else { %>
            <div style="text-align: center; padding: 30px; color: #666;">
                <p>No comments yet. Be the first to comment!</p>
            </div>
        <% } %>
    </div>
</div> 